module VerilogSimulation;
 int Initial_Flag;
 int New_Mode_Flag;
 int Running_Mode;
 int Set_Button;
 int Start_Button;
 int Standby_Button;
 int check_flag_VCV;
 int In_Init_Flag;
 int In_Start_Tick;
 int InEx_Flag;
 int peep_observed;
 int In_End_Tick;
 int Ex_Init_Flag;
 int p_plateau_flag;
 int p_plateau_cycles;
 int p_plateau;
 int Exhale_Time;
 int Inhale_Time;
 int ExtraDelayFlag;
 int volumeORpressureMode;
 int Sensors_Running;
 int check_flag_sensors;
 logic VCVmodeHandle;
 logic SensorsHandle;
 byte txx [254:0]; 
 int cmd_end [2:0]; 
 int t3;
 logic VCV_InRet;

   function void StartVCVmode(void const * argument)
              if(Initial_Flag == 1) begin
		                       Initial_Flag = 0;
		                       t3 = HAL_GetTick();
               end
             
              else if(Initial_Flag == 0) begin
		                       Initial_Flag = 1;
			              if(Running_Mode != 1) begin
		                          VCVmodeHandle = 0;
	            			  end
               end
             
              else begin
		                       New_Mode_Flag = 1;
               end
             
                 Initial_Flag = 0;
                 Initial_Flag = 1;
              if(Set_Button == 1) begin
		                       Set_Button = 0;
		                       volumeORpressureMode = 0;
               end
             
              if(Start_Button == 1) begin
		                       Start_Button = 0;
		                       SensorsHandle = 1;
		                       Sensors_Running = 1;
               end
             
              if(Standby_Button == 1) begin
		                       Standby_Button = 0;
		                       Sensors_Running = 0;
               end
             
                 check_flag_VCV = check_flag_VCV+1;
                 check_flag_sensors = 0;
                 In_Init_Flag = 1;
                 InEx_Flag = 1;
                 In_Start_Tick = HAL_GetTick();
              if(VCV_InRet.status != osEventTimeout) begin
		                       In_End_Tick = HAL_GetTick();
		                       ExtraDelayFlag = 1;
		                       ExtraDelayFlag = 0;
               end
             
                 Ex_Init_Flag = 1;
                 InEx_Flag = 0;
                 p_plateau_cycles = p_plateau_cycles+1;
              if(p_plateau_cycles >= 50) begin
		                       VCVmodeHandle = 0;
		                       p_plateau_flag = 1;
		                       p_plateau = get_pressure();
		                       txx[0] = 'p';
		                       txx[1] = 'p';
		                       txx[2] = 'l';
		                       txx[3] = 'a';
		                       txx[4] = 't';
		                       txx[5] = '.';
		                       txx[6] = 'v';
		                       txx[7] = 'a';
		                       txx[8] = 'l';
		                       txx[9] = '=';
		                       txx[10] = p_plateau/100 + '0';
		                       txx[11] = (p_plateau%100)/10 + '0';
		                       txx[12] = p_plateau%10 + '0';
		                       p_plateau_cycles = 0;
		                       p_plateau_flag = 0;
               end
             
        


  initial begin
	Start_VCVmode(27);
end //initial begin  

endmodule
